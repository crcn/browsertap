var Diffbot = require('diffbot').Diffbot,
logger = require('winston').loggers.get('scraper.part.diffbot'),
sprintf = require('sprintf').sprintf;

/**
 {
	developerKey
}
 */


exports.plugin = function(router, params) {
	var diffbot = new Diffbot(params.developerKey);
	
	
	router.on({
		
		
		/**
		 */
		
		'collect scraper': function(req, res) {
			
			res.end({
				name: 'String',
				scrapeArticle: function(opsOrUrl, callback) {
					console.log('Scraping article using diffbot');
					
					if(typeof opsOrUrl == 'string') {
						ops = { uri: opsOrUrl };
					} else {
						ops = opsOrUrl;
					}
					
					diffbot.article(ops, function(err, response) {
						if(response.media) {
							
							
							//ugh >.>
							response.media.forEach(function(md) {


								if(md.type == 'image') {
									md.regular = { link: md.link };
								}
							})
						}
						

						callback(response)
					});
				}
			});
		}
	})
}