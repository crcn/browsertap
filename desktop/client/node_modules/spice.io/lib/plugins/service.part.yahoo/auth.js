var OAuthHandler = require('psk/auth').OAuthHandler,
	Yahoo = require('./yahoo').Yahoo;

//id=cloveapp.com
//secret=V5A2yxsQigf6X6MX2F54cWG4
var YahooAuthHandler = OAuthHandler.extend({
	name:'yahoo',
	'override __construct': function (appParams)
	{
		// this.loginUrl = 'https://twitter.com/oauth/authorize';
		// this.authUrl = 'https://twitter.com/oauth/authenticate';
		this._super('https://api.login.yahoo.com/oauth/v2/request_auth',
		'https://api.login.yahoo.com/oauth/v2/get_request_token',
		'https://api.login.yahoo.com/oauth/v2/get_token',
		appParams,
		'1.0',
		null,
		'HMAC-SHA1');
	},
	'getAuthorizeCallback': function (request)
	{
		return request.getRouteUrl('social.auth.orized', [request.data.service]);
	},
	'getAccountInfo': function (result, callback)
	{
		var y = new Yahoo(this,result);
		
		y.private.yql('select * from social.profile where guid=me;', function(err, info)
		{
			if(err) return callback(true);
			var profile = info.query.results.profile;
			callback(null, profile.guid, {}, profile.nickname || profile.emails[0].handle);
		});
		
	}
});

exports.YahooAuthHandler = YahooAuthHandler;