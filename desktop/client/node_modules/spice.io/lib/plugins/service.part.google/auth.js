var OAuthHandler = require('psk/auth').OAuthHandler,
	utils = require('sk/node/utils');

//id=cloveapp.com
//secret=V5A2yxsQigf6X6MX2F54cWG4
var GoogleAuthHandler = OAuthHandler.extend({
	name:'google',
	'override __construct': function(appParams)
	{
		// this.loginUrl = 'https://twitter.com/oauth/authorize';
		// this.authUrl = 'https://twitter.com/oauth/authenticate';
		this._super('https://www.google.com/accounts/OAuthAuthorizeToken',
		'https://www.google.com/accounts/OAuthGetRequestToken',
		'https://www.google.com/accounts/OAuthGetAccessToken',
		appParams,
		'1.0',
		null,
		'HMAC-SHA1',
		null,
		{
			Connection: 'keep-alive'
		});
	},
	'getAuthorizeCallback': function(request)
	{
		return 'http://'+request.host+'/authorize/google';
		// return request.getRouteUrl('social.auth.orized', [request.data.service]);
	},
	'getRequestTokenParams': function()
	{
		return {scope: 'http://www.google.com/reader/api/ https://www.googleapis.com/auth/userinfo#email http://gdata.youtube.com' };
	},
	'getAccountInfo': function(result,callback)
	{
		var acc = {secret:result}, s = this;    
		
		/*
		To subscribe a new feed (for exemple http://xkcd.com/rss.xml), you can call:
		http://www.google.com/reader/api/0/subscription/edit?client=contact:myname-at-gmail
		with POST arguments : s=http://xkcd.com/rss.xml&ac=subscribe&token=here-put-a-valid-token
		*/
		                       
	   /*   */
		
             
		                     
		this.get('https://www.googleapis.com/userinfo/email?alt=json',acc,null,function(err,result)
		{                        
			try
			{
				var data = JSON.parse(result).data;
				callback(null,data.email,{},data.email);   
			}catch(e)
			{
				console.error(e)
			}
		})
	}
});



exports.GoogleAuthHandler = GoogleAuthHandler;