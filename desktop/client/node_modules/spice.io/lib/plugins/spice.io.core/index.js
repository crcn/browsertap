var vine = require('vine'),
yaconfig = require('yaconfig'),
outcome  = require('outcome'),
beanpoll = require('beanpoll'),
fs = require('fs')



exports.plugin = function(router, params) {
	

	var cfg = yaconfig.file('/etc/spice.io/config.json'),
	p = this.params().thyme;

	throttle = p && p.throttle ? p.throttle : {};

	throttle.queue = process.env.SLAVE_APP_NAME;


	router.on({


		/**
		 */

		'push -pull -hook thyme/ready': function() {
			router.push('thyme/throttle', throttle);
		},

		
		/**
		 */

		'pull -overridable -ttl=3600 -method=GET /': function(req, res)
		{
			vine.result(params).end(res);
		},

		/**
		 */

		'push init': function() {
			
			router.push('spice.io/config', cfg);
		}
	})
}