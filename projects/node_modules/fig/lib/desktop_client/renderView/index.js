var jsdom = require('jsdom'),
fs = require('fs'),
jqueryStr = fs.readFileSync(__dirname + '/vendors/jquery.js').toString(),
logger = require('mesh-winston').loggers.get('fig');


module.exports = function(view, res) {


	// var tpl = res.req.sanitized.rootTpl ? fs.readFileSync(res.req.sanitized.rootTpl, 'utf8') : '<html><head></head><body></body></html>';
	
	jsdom.env({
		html: '<html><head></head><body></body></html>',
		src: [ jqueryStr ],
		done: function(errors, window) {

			view.setup({ el: window.document, $: window.$, document: window.document }).init({
				complete: function() {

					if(res.header) res.header({ mime: 'text/html' });
					logger.debug('rendered fig view');

					res.end(window.document.innerHTML);

				}
			});

		}
	});
}