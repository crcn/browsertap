var fs = require('fs');

function readFileSync(dirs, name) {

	for(var i = dirs.length; i--;) {
		try {
			return fs.readFileSync(dirs[i] + "/"  + name, 'utf8');
		} catch(e) {
		}	
	}

	return null;
}



exports.plugin = function(params) {

	var rootDirs = [params, '/'];


	return { 

		load: function(path, callback) {

			if(path.substr(0,1) == '.') path = path.substr(1);

			var source;

			if(source = readFileSync(rootDirs, path)) {

				callback(null, source);
				
			} else {
				callback(new Error("Unable to load template "+path+", File does not exist."))
			}
		}
	}
}