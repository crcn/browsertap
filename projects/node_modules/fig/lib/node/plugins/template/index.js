var fs = require('fs');

function readFileSync(dirs, name) {

	for(var i = dirs.length; i--;) {
		try {
			return fs.readFileSync(dirs[i] + "/"  + name, 'utf8');
		} catch(e) {
		}	
	}

	return null;
}


exports.plugin = function(router, params) {
	
	var rootDirs = [this.params('publicDir'), '/'];

	router.on({

		/**
		 */

		'pull -public template OR template/:name': function(req, res, mw) {

			var name = mw.data('name');     

			if(name.substr(0,1) == '.') name = name.substr(1);


			if(!(req.template = readFileSync(rootDirs, name))) {

				console.error("Unable to load template %s, File does not exist.", mw.data('name'));

				if(!mw.next()) {

					res.end('');

				}
			}

			if(!mw.next()) {

				return res.end(req.template);

			}
		}
	})
    
}