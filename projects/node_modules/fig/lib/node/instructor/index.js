var Structr = require('structr');

module.exports = Structr({
	
	/**
	 */

	'__construct': function(target)
	{
		this._instructions = [];
		this._target = target;
	},
	
	/**
	 */

	'add': function(instructions)
	{
		this._instructions = this._instructions.concat(instructions);

		this._next();
	},

	/**
	 */

	'_next': function()
	{
		if(this._running || !this._instructions.length)
		{
			return;
		}

		this._running = true;
		var self = this;


		var name = this._instructions.shift();


		this._target[name](function()
		{
			self._target.change(name);


			if(!self._instructions.length)
			{
				self._target.complete = true;
				self._target.change('complete');
			}
		
			self._running = false;
			self._next();
		});
	}
});