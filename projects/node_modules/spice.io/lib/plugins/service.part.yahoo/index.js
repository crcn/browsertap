var YahooAuthHandler = require('./auth').YahooAuthHandler,
Yahoo = require('./yahoo').Yahoo;

exports.params = {consumerKey: {type: 'input',name: 'Consumer Key'},consumerSecret:{type:'input',name:'Consumer Secret'}}
exports.plugin = function(router, params)
{
	var service = new (function()
	{
		var auth = this.auth = new YahooAuthHandler(params);
	});
	
	function getSocialService(req, res)
	{

		var info = 
		{
			type:'graph'
			,name:'Yahoo'
			,service: service,
			loaders:
			{
				default:
				{
					reader:
					{
						name:'Reader' 
						,load:function(data,callback)
						{
							// this.service.loadData({screen_name:data.q},'getUserTimeline',callback);
						}   
					}
				}
			}
		}


		res.end(info);
	}	
	
	
	function executeYQL(req, res)
	{
		var data = res.query;
			
		var user = data.user,
			query = data.query;

		if(user)
		{
			var y = new Yahoo(service.auth, user.secret);
			y.private.yql(query, function() {
				res.end.apply(res, arguments);
			});
		}
		else
		{
			console.error('Cannot execute YQL without a user.');
		}
	}
	
	router.on({
		'collect social/service': getSocialService,
		'pull yql': executeYQL
	})
}
