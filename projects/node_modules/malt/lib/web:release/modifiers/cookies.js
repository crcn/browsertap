var modifiers = require('../').modifiers;


var cookies = {
	
	set: function(name,value,expires)
	{
		document.cookie = name + "=" + escape(JSON.stringify({v:value})) + "; path=/" + ((expires == null) ? "" : "; expires=" + expires.toGMTString());
	},

	get: function(name)
	{
		var dc = document.cookie;	
		var cname = name + "=";	

		if (dc.length > 0) 
		{	
			begin = dc.indexOf(cname); 
			if (begin != -1) 
			{ 
				begin += cname.length; 
				end = dc.indexOf(";",begin);
				if (end == -1) end = dc.length;
				return JSON.parse(unescape(dc.substring(begin, end))).v;
			} 
		}	
		return null;
	}
};


exports.remove = function(name)
{                            
	sk.cookies.set(name,false,new Date(0));  
}


modifiers.setting.cookies = {


	/**
	 */

	'get': function(key, model, callback)
	{
		var serialized = cookies.get(key);

		if(serialized)
		{
			var clazz = model.models[seralized.t];
			callback(clazz ? new clazz(serialized.v) : serialized.v);
		}
	},
	
	/**
	 */

	'set': function(key, value)
	{
		var serialized = {
			t: (value || '').name,
			v: value
		};

		cookies.set(key, serialized);
	}

}