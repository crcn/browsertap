var malt = require('malt'),
models = malt.models;

require('malt/web/modifiers')

models.Feed = models.Item.extend({

	'static schema': {
		action : {
			type: Object,
			setting: 'cookies'
		}
	}

});


models.Group = models.Item.extend({

	/**
	 */

	channel : '/groups',

	/**
	 */

	children: function()
	{
		return this.collection('children', this.__construct);	
	},

	/**
	 */

	
	feeds: function()
	{
		return this.collection('feeds', this.models.Feed);
	}
	
});


models.post = models.Item.extend({

	/**
	 */

	'override __construct': function()
	{
		this._super.apply(this, arguments);
	}
});


models.Stream = models.Collection.extend({

	/**
	 */

	'override __construct': function(uri)
	{
		this._super({ uri: uri });	
	},

	/**
	 */

	'_channel': function()
	{
		return this.get('uri');
	}
});




var cliqly = malt.connect('http://cliqly.spice.io', function()
{
	cliqly.push('set/id','17797eb8965d22afec064bd9a091fbf77e8ea6af');

	cliqly.models.Group.findOne({ type: 'root' }, function(item)
	{
		var child = item.children().create();

		child.save({ publicName: 'craig' }, function()
		{
			var feed = child.feeds().create();


			child.feeds().sync({
				add: function(feed)
				{
					console.log(feed.doc)
				}
			})
		});

		item.children().sync({
			add: function(child)
			{
				// child.remove();
			}
		})
	});


	
});